<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smarttravel.route.mapper.UserRouteFavoriteMapper">

    <insert id="insert">
        INSERT INTO user_route_favorite
        (user_id, route_id, create_time, update_time, del_flag)
        VALUES
        (#{userId}, #{routeId}, NOW(), NOW(), 0)
    </insert>

    <update id="delete">
        UPDATE user_route_favorite
        SET del_flag = 1, update_time = NOW()
        WHERE user_id = #{userId} AND route_id = #{routeId} AND del_flag = 0
    </update>

    <select id="checkExists" resultType="int">
        SELECT COUNT(1)
        FROM user_route_favorite
        WHERE user_id = #{userId} AND route_id = #{routeId} AND del_flag = 0
    </select>

    <select id="selectByUserId" parameterType="long" resultType="map">
        SELECT urf.id, urf.user_id as userId, urf.route_id as routeId, urf.create_time as createTime,
               tr.route_name as routeName, tr.city_id as cityId, tr.days, tr.summary, tr.cover_image as coverImage,
               tr.favorite_count as favoriteCount
        FROM user_route_favorite urf
        LEFT JOIN travel_route tr ON urf.route_id = tr.id
        WHERE urf.user_id = #{userId} AND urf.del_flag = 0 AND tr.del_flag = 0
        ORDER BY urf.create_time DESC
    </select>

</mapper>





























