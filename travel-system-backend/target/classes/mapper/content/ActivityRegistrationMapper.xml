<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smarttravel.content.mapper.ActivityRegistrationMapper">

    <select id="selectParticipantsByActivityId" resultType="java.util.HashMap">
        SELECT 
            ar.id,
            ar.activity_id AS activityId,
            ar.user_id AS userId,
            ar.registration_time AS registrationTime,
            u.nickname,
            u.avatar,
            u.city,
            u.gender,
            u.note_count AS noteCount,
            u.checkin_count AS checkinCount,
            u.favorite_count AS favoriteCount,
            (SELECT COUNT(*) FROM activity_registration ar2 WHERE ar2.user_id = ar.user_id AND ar2.del_flag = 0) AS activityCount
        FROM activity_registration ar
        LEFT JOIN user u ON ar.user_id = u.id AND u.del_flag = 0
        WHERE ar.activity_id = #{activityId} AND ar.del_flag = 0
        ORDER BY ar.registration_time DESC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>

    <select id="countByActivityId" resultType="int">
        SELECT COUNT(1)
        FROM activity_registration
        WHERE activity_id = #{activityId} AND del_flag = 0
    </select>

    <select id="countByUserId" resultType="int">
        SELECT COUNT(1)
        FROM activity_registration
        WHERE user_id = #{userId} AND del_flag = 0
    </select>

</mapper>

